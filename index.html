<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Device Device</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="jquery.js"></script>
    <script src="gyronorm.js"></script>
    <script src="js/jquery.flightindicators.min.js"></script>
    <link rel="stylesheet" href="css/flightindicators.min.css" />
  </head>
  <body>
    <span id="attitude">loading...</span>
    <span id="speedometer">loading...</span>
    <span id="heading">loading...</span>
    <span id="altimeter">loading...</span>
    <span id="vario">loading...</span>
    <script>
      var gn = new GyroNorm();

      var speedometer = $.flightIndicator("#speedometer", "airspeed", {
        showBox: false
      });
      var heading = $.flightIndicator("#heading", "heading", {
        showBox: false
      });
      var altimeter = $.flightIndicator("#altimeter", "altimeter", {
        showBox: false
      });
      var attitude = $.flightIndicator("#attitude", "attitude", {
        showBox: false
      });
      var variometer = $.flightIndicator("#vario", "variometer", {
        showBox: false
      });

      gn.init()
        .then(function() {
          gn.start(function(data) {
            // Process:
            // data.do.alpha	( deviceorientation event alpha value )
            // data.do.beta		( deviceorientation event beta value )
            // data.do.gamma	( deviceorientation event gamma value )
            // data.do.absolute	( deviceorientation event absolute value )
            // data.dm.x		( devicemotion event acceleration x value )
            // data.dm.y		( devicemotion event acceleration y value )
            // data.dm.z		( devicemotion event acceleration z value )
            // data.dm.gx		( devicemotion event accelerationIncludingGravity x value )
            // data.dm.gy		( devicemotion event accelerationIncludingGravity y value )
            // data.dm.gz		( devicemotion event accelerationIncludingGravity z value )
            // data.dm.alpha	( devicemotion event rotationRate alpha value )
            // data.dm.beta		( devicemotion event rotationRate beta value )
            // data.dm.gamma	( devicemotion event rotationRate gamma value )
//             document.getElementById("info").innerHTML = JSON.stringify(data);
            heading.setHeading(data.do.alpha);
            attitude.setPitch(data.do.beta);
            attitude.setRoll(data.do.gamma);
            variometer.setVario(data.dm.y);
          });
        })
        .catch(function(e) {
          // Catch if the DeviceOrientation or DeviceMotion is not supported by the browser or device
          console.log({ e });
        });

      navigator.geolocation.watchPosition(
        function(position) {
          speedometer.setAirSpeed(position.coords.speed);
          altimeter.setAltitude(position.coords.altitude);
        },
        function(fail) {
          console.log({ fail });
        },
        { enableHighAccuracy: true }
      );
    </script>
  </body>
</html>
